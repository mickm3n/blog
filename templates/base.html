{% import "macros.html" as macro -%}

{% if page.extra.image %}
{% set sns_image = get_url(path=page.colocated_path ~ page.extra.image) %}
{% set twitter_card = "summary_large_image" %}
{% set image_width = 1200 %}
{% else %}
{% set sns_image = get_url(path="images/default-og-image.webp") %}
{% set twitter_card = "summary" %}
{% set image_width = 630 %}
{% endif %}

{% if page.title %}
{% set title = page.title %}
{% else %}
{% set title = config.title %}
{% endif %}

{% if page.description %}
{% set description = page.description %}
{% else %}
{% set description = "é–±è®€å¿ƒå¾—èˆ‡æƒ³æ³•ï¼Œæ²’æœ‰ç‰¹å®šçš„é–±è®€ä¸»é¡Œï¼Œå¿ƒç†å­¸ã€æŠ•è³‡ã€å“²å­¸ã€æ­·å²ã€ç”Ÿç‰©éƒ½æ˜¯æœ‰æ©Ÿæœƒæ¶‰çµçš„é ˜åŸŸï¼Œæ„æ—¨åœ¨åŸ¹é¤Šèƒ½äº†è§£ä¸–ç•Œçš„æ€ç¶­æ¨¡å‹ã€‚" %}
{% endif %}
<!DOCTYPE html>
<html lang="zh-TW" itemscope itemtype="http://schema.org/Blog">

  <head>
    <title>{{ title }}</title>
    <meta name="description" itemprop="about" content="{{ description }}" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="{{ title }}" />
    <meta property="og:description" content="{{ description }}" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="{{ sns_image }}" />
    <meta property="og:image:width" content="{{ image_width }}" />
    <meta property="og:image:height" content="630" />
    <meta property="og:url" content="{{ current_url }}" />
    <meta name="twitter:card" content="{{ twitter_card }}" />
    <script src="{{ get_url(path="js/tablesort.min.js", cachebust=true) }}" defer></script>
    <script src="{{ get_url(path="js/copy-code-button.js") | safe }}" defer></script>
    <link rel="icon" href="{{ get_url(path="images/favicon.ico", cachebust=true) }}" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600&family=Noto+Serif+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ get_url(path="site/styles/w3.css", trailing_slash=false, cachebust=true) | safe }}">
    <link rel="stylesheet"
      href="{{ get_url(path="site/styles/site.css", trailing_slash=false, cachebust=true) | safe }}">
    <link rel="alternate" type="application/atom+xml" href="{{ config.base_url }}/atom.xml"
      title="{{ config.title }}" />
    <!-- Theme toggle: runs before paint to prevent flash of wrong theme -->
    <script src="{{ get_url(path="js/theme-toggle.js", cachebust=true) | safe }}"></script>
  </head>

  <body>
    <header>
      <nav class="site-nav" role="navigation" aria-label="ä¸»è¦å°èˆª">
        <!-- Top bar: always visible -->
        <div class="site-nav__topbar">
          <a class="site-nav__logo" href="{{ config.base_url }}" aria-label="å›é¦–é ">
            <img src="{{ get_url(path="images/logo_630.webp", trailing_slash=false, cachebust=true) | safe}}" width="48"
              height="48" alt="é‡ç¹”æ‹™è¦‹ Logo">
          </a>
          <div class="site-nav__actions">
            <button id="hamburger-btn" class="hamburger-btn" aria-label="é–‹å•Ÿé¸å–®" aria-expanded="false" aria-controls="mobile-nav">
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
            </button>
          </div>
        </div>
        <!-- Nav links: horizontal on desktop, collapsible on mobile -->
        <div id="mobile-nav" class="site-nav__links">
          <a class="site-nav__link" href="/reading-notes/">é–±è®€ç­†è¨˜</a>
          <a class="site-nav__link" href="/blog/">éƒ¨è½æ ¼æ–‡ç« </a>
          <div class="site-nav__dropdown">
            <button class="site-nav__dropdown-btn" aria-haspopup="true" aria-expanded="false">çœ¾äººçš„æ™ºæ…§ â–¾</button>
            <div class="site-nav__dropdown-menu" role="menu">
              <a class="site-nav__dropdown-item" href="/wisdom/articles/" role="menuitem">æ–‡ç« </a>
              <a class="site-nav__dropdown-item" href="/wisdom/videos/" role="menuitem">å½±ç‰‡</a>
              <a class="site-nav__dropdown-item" href="/wisdom/podcasts/" role="menuitem">Podcast</a>
              <a class="site-nav__dropdown-item" href="/wisdom/lists/" role="menuitem">æ¸…å–®</a>
              <a class="site-nav__dropdown-item" href="/wisdom/mental-models/" role="menuitem">æ€ç¶­æ¨¡å‹</a>
              <a class="site-nav__dropdown-item" href="/wisdom/methods/" role="menuitem">æ–¹æ³•</a>
              <a class="site-nav__dropdown-item" href="/wisdom/strategies/" role="menuitem">ç­–ç•¥</a>
              <a class="site-nav__dropdown-item" href="/wisdom/templates/" role="menuitem">ç¯„æœ¬</a>
            </div>
          </div>
          <a class="site-nav__link" href="/about/">é—œæ–¼</a>
          <a class="site-nav__link" href="/now/">Now Page</a>
          <button id="theme-toggle-btn" class="theme-toggle site-nav__theme-toggle" aria-label="åˆ‡æ›é¡¯ç¤ºä¸»é¡Œ">
            ğŸŒ™ æ·±è‰²
          </button>
          <form action="https://www.google.com/search" id="search" method="get" target="_blank" class="site-nav__search">
            <input type="text" name="q" placeholder="æœå°‹..." class="site-nav__search-input" aria-label="æœå°‹">
            <input type="hidden" name="sitesearch" value="{{ config.base_url }}">
            <button type="submit" class="site-nav__search-btn" aria-label="é€å‡ºæœå°‹">&#128269;</button>
          </form>
        </div>
      </nav>
    </header>
    <main id="root" class="body-zone flex justify-between flex-1 main-inner">
      <section class="main flex-1 py">
        {% block content %}
        {% endblock content %}
      </section>
      <aside class="sidebar">
        {% block additional_aside %}
        {% endblock additional_aside %}
        <div class="sidebar-element">
          <h2>æœ€æ–°é–±è®€ç­†è¨˜</h2>
          <ul>
            {% set blog_section = get_section(path="reading-notes/_index.md") -%}
            {% for page in blog_section.pages | slice(begin=0,end=3)  %}
            <li>
              <a class="no-underline" href="{{ page.permalink | safe }}">{{ page.title }}</a>
              <span class="muted text-sm">{{ page.date }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        <div class="sidebar-element">
          <h2>æœ€æ–°å…¶ä»–æ–‡ç« </h2>
          <ul>
            {% set blog_section = get_section(path="blog/_index.md") -%}
            {% for page in blog_section.pages | slice(begin=0,end=7)  %}
            <li>
              <a class="no-underline" href="{{ page.permalink | safe }}">{{ page.title }}</a>
              <span class="muted text-sm">{{ page.date }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        <div class="sidebar-element">
          <h2>ä¾åˆ†é¡</h2>
          <ul>
            {% set categories_taxonomy = get_taxonomy(kind="categories") %}
            {% for cat in categories_taxonomy.items %}
            {% set url = get_taxonomy_url(kind="categories", name=cat.name) %}
            <li>
              <a class="no-underline" href="{{ url }}">{{ cat.name }} ({{ cat.pages | length }})</a>
            </li>
            {% endfor %}
          </ul>
          <!-- <h2>ä¾æ¨™ç±¤</h2>
          <ul>
            {% set tags_taxonomy = get_taxonomy(kind="tags") %}
            {% for cat in tags_taxonomy.items %}
            {% set url = get_taxonomy_url(kind="tags", name=cat.name) %}
            <li>
              <a class="no-underline" href="{{ url }}">{{ cat.name }} ({{ cat.pages | length }})</a>
            </li>
            {% endfor %}
          </ul> -->
        </div>
      </aside>
    </main>
    <footer>
    </footer>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Mark external links
        var links = document.querySelectorAll("a");
        links.forEach(function (link) {
          if (link.hostname !== window.location.hostname && !link.querySelector('img')) {
            link.classList.add("external-link");
          }
        });

        // Hamburger menu toggle
        var hamburgerBtn = document.getElementById("hamburger-btn");
        var mobileNav = document.getElementById("mobile-nav");
        if (hamburgerBtn && mobileNav) {
          hamburgerBtn.addEventListener("click", function () {
            var isOpen = mobileNav.classList.toggle("is-open");
            hamburgerBtn.classList.toggle("is-open", isOpen);
            hamburgerBtn.setAttribute("aria-expanded", isOpen ? "true" : "false");
            mobileNav.setAttribute("aria-hidden", isOpen ? "false" : "true");
          });
          // Close menu when a link is clicked
          mobileNav.querySelectorAll("a").forEach(function (link) {
            link.addEventListener("click", function () {
              mobileNav.classList.remove("is-open");
              hamburgerBtn.classList.remove("is-open");
              hamburgerBtn.setAttribute("aria-expanded", "false");
              mobileNav.setAttribute("aria-hidden", "true");
            });
          });
        }

        // Dropdown toggle for mobile
        var dropdownBtns = document.querySelectorAll(".site-nav__dropdown-btn");
        dropdownBtns.forEach(function (btn) {
          btn.addEventListener("click", function () {
            var menu = btn.nextElementSibling;
            if (menu) {
              var isExpanded = btn.getAttribute("aria-expanded") === "true";
              btn.setAttribute("aria-expanded", !isExpanded ? "true" : "false");
              menu.style.display = isExpanded ? "" : "block";
            }
          });
        });
      });
    </script>
    {% block script %}
    {% endblock script %}
  </body>

</html>
